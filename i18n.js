// Bend App - Internationalization System
// Lightweight i18n system for English, German, and Spanish

class BendI18n {
    constructor() {
        this.currentLang = this.detectLanguage();
        this.translations = this.getBuiltInTranslations();
        this.isLoaded = true;
        
        this.updateDocumentLanguage();
    }

    // Detect user's preferred language
    detectLanguage() {
        // Priority: localStorage > navigator language > default 'en'
        const saved = localStorage.getItem('bend-language');
        if (saved) return saved;
        
        const browserLang = navigator.language || navigator.userLanguage || 'en';
        const lang = browserLang.split('-')[0]; // Get base language (en from en-US)
        
        // Support en, de, es, ta
        return ['en', 'de', 'es', 'ta'].includes(lang) ? lang : 'en';
    }

    // Get translation for a key
    t(key, params = {}) {
        const translation = this.getNestedValue(this.translations[this.currentLang], key) ||
                          this.getNestedValue(this.translations.en, key) ||
                          key;
        
        // Replace parameters in translation
        return this.interpolate(translation, params);
    }

    // Get nested object value by dot notation
    getNestedValue(obj, key) {
        return key.split('.').reduce((o, k) => (o && o[k] !== undefined) ? o[k] : null, obj);
    }

    // Replace parameters in translation strings
    interpolate(str, params) {
        return str.replace(/\{\{(\w+)\}\}/g, (match, key) => params[key] || match);
    }

    // Change language
    changeLanguage(lang) {
        if (lang === this.currentLang) return;
        if (!['en', 'de', 'es', 'ta'].includes(lang)) return;
        
        this.currentLang = lang;
        localStorage.setItem('bend-language', lang);
        this.updateDocumentLanguage();
        this.applyTranslations();
        
        // Notify listeners about language change
        document.dispatchEvent(new CustomEvent('languageChanged', { 
            detail: { language: lang } 
        }));
    }

    // Update document language attributes
    updateDocumentLanguage() {
        document.documentElement.lang = this.currentLang;
        
        // Update meta description if available
        const metaDesc = document.querySelector('meta[name="description"]');
        if (metaDesc) {
            metaDesc.content = this.t('app.description');
        }
    }

    // Apply translations to elements with data-i18n attributes
    applyTranslations() {
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            const translation = this.t(key);
            
            if (element.hasAttribute('data-i18n-attr')) {
                // Translate attribute
                const attr = element.getAttribute('data-i18n-attr');
                element.setAttribute(attr, translation);
            } else {
                // Translate text content
                element.textContent = translation;
            }
        });
        
        // Apply placeholder translations
        document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
            const key = element.getAttribute('data-i18n-placeholder');
            element.placeholder = this.t(key);
        });
    }

    // Get list of available languages
    getAvailableLanguages() {
        return [
            { code: 'en', name: 'English', flag: 'üá∫üá∏' },
            { code: 'de', name: 'Deutsch', flag: 'üá©üá™' },
            { code: 'es', name: 'Espa√±ol', flag: 'üá™üá∏' },
            { code: 'ta', name: '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç', flag: 'üá±üá∞' }
        ];
    }

    // Built-in translations to ensure app always works
    getBuiltInTranslations() {
        return {
            en: {
                app: {
                    title: "Bend",
                    subtitle: "Stretching & Flexibility",
                    description: "A gentle stretching and flexibility app designed for all ages and abilities"
                },
                navigation: {
                    back: "Back",
                    next: "Next",
                    previous: "Previous",
                    start: "Start",
                    pause: "Pause",
                    skip: "Skip",
                    chooseRoutine: "Choose a routine:"
                },
                timer: {
                    switchSides: "Switch sides",
                    exerciseComplete: "Exercise Complete",
                    routineComplete: "Routine Complete",
                    progress: "{{current}} of {{total}}"
                },
                routines: {
                    wakeUp: "Wake Up",
                    bedTime: "Bed Time", 
                    neckShoulders: "Neck & Shoulders",
                    backSpine: "Back & Spine",
                    legsHips: "Legs & Hips",
                    armsWrists: "Arms & Wrists",
                    feetAnkles: "Feet & Ankles",
                    fullBody: "Full Body",
                    quickStretch: "Quick Stretch",
                    postureReset: "Posture Reset",
                    sleep: "Sleep",
                    expert: "Expert",
                    hips: "Hips",
                    hamstrings: "Hamstrings",
                    lowerBack: "Lower Back",
                    isometric: "Isometric",
                    neck: "Neck",
                    shoulders: "Shoulders",
                    feet: "Feet",
                    ankle: "Ankle",
                    knees: "Knees",
                    hands: "Hands",
                    fingers: "Fingers",
                    wrists: "Wrists",
                    wakeUpComplete: "Wake Up Complete",
                    neckShoulders5min: "Neck & Shoulders - 5 min",
                    neckShoulders10min: "Neck & Shoulders - 10 min"
                },
                folders: {
                    hips: "Hips",
                    shoulders: "Shoulders",
                    lowerBack: "Lower Back", 
                    neck: "Neck",
                    hamstrings: "Hamstrings",
                    feetAnkles: "Feet & Ankles",
                    core: "Core",
                    upperBody: "Upper Body",
                    lowerBody: "Lower Body",
                    seated: "Seated",
                    posture: "Posture",
                    chest: "Chest"
                },
                exercises: {
                    neckrolls: {
                        name: "Neck Rolls",
                        description: "Slowly roll your head in a circle, first clockwise, then counterclockwise. Keep movements gentle and controlled."
                    },
                    shouldershrugs: {
                        name: "Shoulder Shrugs",
                        description: "Lift your shoulders up toward your ears, hold for 3 seconds, then relax. Repeat slowly."
                    },
                    sideneckstretch: {
                        name: "Side Neck Stretch",
                        description: "Gently tilt your head to the right, hold for 15 seconds, then repeat on the left side."
                    },
                    forwardneckstretch: {
                        name: "Forward Neck Stretch",
                        description: "Slowly lower your chin toward your chest, feeling a gentle stretch in the back of your neck."
                    },
                    armcircles: {
                        name: "Arm Circles",
                        description: "Make small circles with your arms, first forward, then backward. Keep movements slow and controlled."
                    },
                    gentleTwist: {
                        name: "Gentle Twist",
                        description: "Stand with feet hip-width apart, place your hands on your hips, and gently twist from side to side."
                    },
                    calfraises: {
                        name: "Calf Raises",
                        description: "Stand tall and slowly rise up onto your toes, then lower back down. Keep movements controlled."
                    },
                    deepbreathing: {
                        name: "Deep Breathing",
                        description: "Take 5 deep breaths, inhaling through your nose and exhaling through your mouth. Feel your body relax."
                    }
                },
                accessibility: {
                    toggleDarkMode: "Toggle dark mode",
                    languageSelector: "Select language",
                    startPauseTimer: "Start or pause exercise timer",
                    nextExercise: "Next exercise",
                    previousExercise: "Previous exercise",
                    backToRoutines: "Go back to routine selection"
                }
            },
            de: {
                app: {
                    title: "Bend",
                    subtitle: "Dehnung & Flexibilit√§t",
                    description: "Eine sanfte Dehnungs- und Flexibilit√§ts-App f√ºr alle Altersgruppen und F√§higkeiten"
                },
                navigation: {
                    back: "Zur√ºck",
                    next: "Weiter",
                    previous: "Vorherige",
                    start: "Start",
                    pause: "Pause",
                    skip: "√úberspringen",
                    chooseRoutine: "W√§hle eine Routine:"
                },
                timer: {
                    switchSides: "Seite wechseln",
                    exerciseComplete: "√úbung abgeschlossen",
                    routineComplete: "Routine abgeschlossen",
                    progress: "{{current}} von {{total}}"
                },
                routines: {
                    wakeUp: "Aufwachen",
                    bedTime: "Schlafenszeit",
                    neckShoulders: "Nacken & Schultern",
                    backSpine: "R√ºcken & Wirbels√§ule",
                    legsHips: "Beine & H√ºften",
                    armsWrists: "Arme & Handgelenke",
                    feetAnkles: "F√º√üe & Kn√∂chel",
                    fullBody: "Ganzk√∂rper",
                    quickStretch: "Schnelle Dehnung",
                    postureReset: "Haltung zur√ºcksetzen",
                    sleep: "Schlaf",
                    expert: "Experte",
                    hips: "H√ºften",
                    hamstrings: "Oberschenkelr√ºckseite",
                    lowerBack: "Unterer R√ºcken",
                    isometric: "Isometrisch",
                    neck: "Nacken",
                    shoulders: "Schultern",
                    feet: "F√º√üe",
                    ankle: "Kn√∂chel",
                    knees: "Knie",
                    hands: "H√§nde",
                    fingers: "Finger",
                    wrists: "Handgelenke",
                    wakeUpComplete: "Vollst√§ndiges Aufwachen",
                    neckShoulders5min: "Nacken & Schultern - 5 Min",
                    neckShoulders10min: "Nacken & Schultern - 10 Min"
                },
                folders: {
                    hips: "H√ºften",
                    shoulders: "Schultern",
                    lowerBack: "Unterer R√ºcken",
                    neck: "Nacken",
                    hamstrings: "Oberschenkelr√ºckseite",
                    feetAnkles: "F√º√üe & Kn√∂chel",
                    core: "Rumpf",
                    upperBody: "Oberk√∂rper",
                    lowerBody: "Unterk√∂rper",
                    seated: "Sitzend",
                    posture: "Haltung",
                    chest: "Brust"
                },
                exercises: {
                    neckrolls: {
                        name: "Nackenrollen",
                        description: "Rollen Sie Ihren Kopf langsam im Kreis, zuerst im Uhrzeigersinn, dann gegen den Uhrzeigersinn. Halten Sie die Bewegungen sanft und kontrolliert."
                    },
                    shouldershrugs: {
                        name: "Schulterzucken",
                        description: "Heben Sie Ihre Schultern zu den Ohren, halten Sie 3 Sekunden, dann entspannen Sie. Wiederholen Sie langsam."
                    },
                    sideneckstretch: {
                        name: "Seitliche Nackendehnung",
                        description: "Neigen Sie Ihren Kopf sanft nach rechts, halten Sie 15 Sekunden, dann wiederholen Sie auf der linken Seite."
                    },
                    forwardneckstretch: {
                        name: "Vorw√§rts Nackendehnung",
                        description: "Senken Sie Ihr Kinn langsam zur Brust, sp√ºren Sie eine sanfte Dehnung im Nacken."
                    },
                    armcircles: {
                        name: "Armkreise",
                        description: "Machen Sie kleine Kreise mit den Armen, zuerst vorw√§rts, dann r√ºckw√§rts. Halten Sie die Bewegungen langsam und kontrolliert."
                    },
                    gentleTwist: {
                        name: "Sanfte Drehung",
                        description: "Stehen Sie mit h√ºftbreit auseinander stehenden F√º√üen, legen Sie Ihre H√§nde auf die H√ºften und drehen Sie sich sanft von Seite zu Seite."
                    },
                    calfraises: {
                        name: "Wadenheben",
                        description: "Stehen Sie aufrecht und heben Sie sich langsam auf die Zehenspitzen, dann senken Sie sich wieder ab. Halten Sie die Bewegungen kontrolliert."
                    },
                    deepbreathing: {
                        name: "Tiefes Atmen",
                        description: "Atmen Sie 5 Mal tief ein, durch die Nase einatmen und durch den Mund ausatmen. Sp√ºren Sie, wie sich Ihr K√∂rper entspannt."
                    }
                },
                accessibility: {
                    toggleDarkMode: "Dunklen Modus umschalten",
                    languageSelector: "Sprache ausw√§hlen",
                    startPauseTimer: "Timer starten oder pausieren",
                    nextExercise: "N√§chste √úbung",
                    previousExercise: "Vorherige √úbung",
                    backToRoutines: "Zur√ºck zur Routineauswahl"
                }
            },
            es: {
                app: {
                    title: "Bend",
                    subtitle: "Estiramiento y Flexibilidad",
                    description: "Una aplicaci√≥n suave de estiramiento y flexibilidad dise√±ada para todas las edades y habilidades"
                },
                navigation: {
                    back: "Atr√°s",
                    next: "Siguiente",
                    previous: "Anterior",
                    start: "Comenzar",
                    pause: "Pausar",
                    skip: "Saltar",
                    chooseRoutine: "Elige una rutina:"
                },
                timer: {
                    switchSides: "Cambia de lado",
                    exerciseComplete: "Ejercicio Completado",
                    routineComplete: "Rutina Completada",
                    progress: "{{current}} de {{total}}"
                },
                routines: {
                    wakeUp: "Despertar",
                    bedTime: "Hora de Dormir",
                    neckShoulders: "Cuello y Hombros",
                    backSpine: "Espalda y Columna",
                    legsHips: "Piernas y Caderas",
                    armsWrists: "Brazos y Mu√±ecas",
                    feetAnkles: "Pies y Tobillos",
                    fullBody: "Cuerpo Completo",
                    quickStretch: "Estiramiento R√°pido",
                    postureReset: "Reinicio de Postura",
                    sleep: "Dormir",
                    expert: "Experto",
                    hips: "Caderas",
                    hamstrings: "Isquiotibiales",
                    lowerBack: "Espalda Baja",
                    isometric: "Isom√©trico",
                    neck: "Cuello",
                    shoulders: "Hombros",
                    feet: "Pies",
                    ankle: "Tobillo",
                    knees: "Rodillas",
                    hands: "Manos",
                    fingers: "Dedos",
                    wrists: "Mu√±ecas",
                    wakeUpComplete: "Despertar Completo",
                    neckShoulders5min: "Cuello y Hombros - 5 min",
                    neckShoulders10min: "Cuello y Hombros - 10 min"
                },
                folders: {
                    hips: "Caderas",
                    shoulders: "Hombros",
                    lowerBack: "Espalda Baja",
                    neck: "Cuello",
                    hamstrings: "Isquiotibiales",
                    feetAnkles: "Pies y Tobillos",
                    core: "N√∫cleo",
                    upperBody: "Parte Superior",
                    lowerBody: "Parte Inferior",
                    seated: "Sentado",
                    posture: "Postura",
                    chest: "Pecho"
                },
                exercises: {
                    neckrolls: {
                        name: "Rotaciones de Cuello",
                        description: "Rote su cabeza lentamente en c√≠rculo, primero en el sentido de las agujas del reloj, luego en sentido contrario. Mantenga los movimientos suaves y controlados."
                    },
                    shouldershrugs: {
                        name: "Encogimiento de Hombros",
                        description: "Levante los hombros hacia las orejas, mantenga 3 segundos, luego relaje. Repita lentamente."
                    },
                    sideneckstretch: {
                        name: "Estiramiento Lateral del Cuello",
                        description: "Incline suavemente la cabeza hacia la derecha, mantenga 15 segundos, luego repita en el lado izquierdo."
                    },
                    forwardneckstretch: {
                        name: "Estiramiento Frontal del Cuello",
                        description: "Baje lentamente la barbilla hacia el pecho, sintiendo un estiramiento suave en la parte posterior del cuello."
                    },
                    armcircles: {
                        name: "C√≠rculos con Brazos",
                        description: "Haga c√≠rculos peque√±os con los brazos, primero hacia adelante, luego hacia atr√°s. Mantenga los movimientos lentos y controlados."
                    },
                    gentleTwist: {
                        name: "Giro Suave",
                        description: "P√°rese con los pies separados al ancho de las caderas, coloque las manos en las caderas y gire suavemente de lado a lado."
                    },
                    calfraises: {
                        name: "Elevaci√≥n de Pantorrillas",
                        description: "P√°rese derecho y lev√°ntese lentamente sobre las puntas de los pies, luego baje de nuevo. Mantenga los movimientos controlados."
                    },
                    deepbreathing: {
                        name: "Respiraci√≥n Profunda",
                        description: "Tome 5 respiraciones profundas, inhalando por la nariz y exhalando por la boca. Sienta c√≥mo su cuerpo se relaja."
                    }
                },
                accessibility: {
                    toggleDarkMode: "Alternar modo oscuro",
                    languageSelector: "Seleccionar idioma",
                    startPauseTimer: "Iniciar o pausar temporizador",
                    nextExercise: "Siguiente ejercicio",
                    previousExercise: "Ejercicio anterior",
                    backToRoutines: "Volver a selecci√≥n de rutinas"
                }
            },
            ta: {
                app: {
                    title: "Bend",
                    subtitle: "‡Æ®‡ØÄ‡Æü‡Øç‡Æö‡Æø ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ®‡ØÜ‡Æï‡Æø‡Æ¥‡Øç‡Æµ‡ØÅ",
                    description: "‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æµ‡ÆØ‡Æ§‡Æø‡Æ©‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Æø‡Æ±‡Æ©‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡Æµ‡Æü‡Æø‡Æµ‡ÆÆ‡Øà‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡ÆÆ‡ØÜ‡Æ©‡Øç‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æ© ‡Æ®‡ØÄ‡Æü‡Øç‡Æö‡Æø ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ®‡ØÜ‡Æï‡Æø‡Æ¥‡Øç‡Æµ‡ØÅ ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Ææ‡Æü‡ØÅ"
                },
                navigation: {
                    back: "‡Æ™‡Æø‡Æ©‡Øç",
                    next: "‡ÆÖ‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ",
                    previous: "‡ÆÆ‡ØÅ‡Æ®‡Øç‡Æ§‡Øà‡ÆØ",
                    start: "‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ",
                    pause: "‡Æá‡Æü‡Øà‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ",
                    skip: "‡Æ§‡Æµ‡Æø‡Æ∞‡Øç‡Æï‡Øç‡Æï",
                    chooseRoutine: "‡Æí‡Æ∞‡ØÅ ‡Æµ‡Æ¥‡Æï‡Øç‡Æï‡Æ§‡Øç‡Æ§‡Øà ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç:"
                },
                timer: {
                    switchSides: "‡Æ™‡Æï‡Øç‡Æï‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç",
                    exerciseComplete: "‡Æ™‡ÆØ‡Æø‡Æ±‡Øç‡Æö‡Æø ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ",
                    routineComplete: "‡Æµ‡Æ¥‡Æï‡Øç‡Æï‡ÆÆ‡Ææ‡Æ©‡Æ§‡ØÅ ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ",
                    progress: "{{current}} ‡Æá‡Æ≤‡Øç {{total}}"
                },
                routines: {
                    wakeUp: "‡Æé‡Æ¥‡ØÅ‡Æ®‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ",
                    bedTime: "‡Æ™‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Øà ‡Æ®‡Øá‡Æ∞‡ÆÆ‡Øç",
                    neckShoulders: "‡Æï‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Øã‡Æ≥‡Øç‡Æï‡Æ≥‡Øç",
                    backSpine: "‡ÆÆ‡ØÅ‡Æ§‡ØÅ‡Æï‡ØÅ ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡Æ§‡ØÅ‡Æï‡ØÜ‡Æ≤‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ",
                    legsHips: "‡Æï‡Ææ‡Æ≤‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æá‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç",
                    armsWrists: "‡Æï‡Øà‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Æ£‡Æø‡Æï‡Øç‡Æï‡Æü‡Øç‡Æü‡ØÅ‡Æï‡Æ≥‡Øç",
                    feetAnkles: "‡Æ™‡Ææ‡Æ§‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æ£‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æ≤‡Øç‡Æï‡Æ≥‡Øç",
                    fullBody: "‡ÆÆ‡ØÅ‡Æ¥‡ØÅ ‡Æâ‡Æü‡Æ≤‡Øç",
                    quickStretch: "‡Æµ‡Æø‡Æ∞‡Øà‡Æµ‡ØÅ ‡Æ®‡ØÄ‡Æü‡Øç‡Æö‡Æø",
                    postureReset: "‡Æâ‡Æü‡Æ≤‡Øç‡Æ®‡Æø‡Æ≤‡Øà ‡ÆÆ‡ØÄ‡Æü‡Øç‡Æü‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ",
                    sleep: "‡Æ§‡ØÇ‡Æï‡Øç‡Æï‡ÆÆ‡Øç",
                    expert: "‡Æ®‡Æø‡Æ™‡ØÅ‡Æ£‡Æ∞‡Øç",
                    hips: "‡Æá‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç",
                    hamstrings: "‡Æ™‡Æø‡Æ©‡Øç‡Æ™‡ØÅ‡Æ± ‡Æ§‡ØÅ‡Æü‡Øà ‡Æé‡Æ≤‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ",
                    lowerBack: "‡Æï‡ØÄ‡Æ¥‡Øç ‡ÆÆ‡ØÅ‡Æ§‡ØÅ‡Æï‡ØÅ",
                    isometric: "‡Æê‡Æö‡Øã‡ÆÆ‡ØÜ‡Æü‡Øç‡Æ∞‡Æø‡Æï‡Øç",
                    neck: "‡Æï‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ",
                    shoulders: "‡Æ§‡Øã‡Æ≥‡Øç‡Æï‡Æ≥‡Øç",
                    feet: "‡Æ™‡Ææ‡Æ§‡Æô‡Øç‡Æï‡Æ≥‡Øç",
                    ankle: "‡Æï‡Æ£‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æ≤‡Øç",
                    knees: "‡ÆÆ‡ØÅ‡Æ¥‡Æô‡Øç‡Æï‡Ææ‡Æ≤‡Øç‡Æï‡Æ≥‡Øç",
                    hands: "‡Æï‡Øà‡Æï‡Æ≥‡Øç",
                    fingers: "‡Æµ‡Æø‡Æ∞‡Æ≤‡Øç‡Æï‡Æ≥‡Øç",
                    wrists: "‡ÆÆ‡Æ£‡Æø‡Æï‡Øç‡Æï‡Æü‡Øç‡Æü‡ØÅ‡Æï‡Æ≥‡Øç",
                    wakeUpComplete: "‡ÆÆ‡ØÅ‡Æ¥‡ØÅ‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æ© ‡Æé‡Æ¥‡ØÅ‡Æ®‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡Æ≤‡Øç",
                    neckShoulders5min: "‡Æï‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Øã‡Æ≥‡Øç‡Æï‡Æ≥‡Øç - 5 ‡Æ®‡Æø‡ÆÆ‡Æø‡Æü‡ÆÆ‡Øç",
                    neckShoulders10min: "‡Æï‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Øã‡Æ≥‡Øç‡Æï‡Æ≥‡Øç - 10 ‡Æ®‡Æø‡ÆÆ‡Æø‡Æü‡ÆÆ‡Øç"
                },
                folders: {
                    hips: "‡Æá‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç",
                    shoulders: "‡Æ§‡Øã‡Æ≥‡Øç‡Æï‡Æ≥‡Øç",
                    lowerBack: "‡Æï‡ØÄ‡Æ¥‡Øç ‡ÆÆ‡ØÅ‡Æ§‡ØÅ‡Æï‡ØÅ",
                    neck: "‡Æï‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ",
                    hamstrings: "‡Æ™‡Æø‡Æ©‡Øç‡Æ™‡ØÅ‡Æ± ‡Æ§‡ØÅ‡Æü‡Øà ‡Æé‡Æ≤‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ",
                    feetAnkles: "‡Æ™‡Ææ‡Æ§‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æ£‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æ≤‡Øç‡Æï‡Æ≥‡Øç",
                    core: "‡ÆÆ‡Øà‡ÆØ‡ÆÆ‡Øç",
                    upperBody: "‡ÆÆ‡Øá‡Æ≤‡Øç ‡Æâ‡Æü‡Æ≤‡Øç",
                    lowerBody: "‡Æï‡ØÄ‡Æ¥‡Øç ‡Æâ‡Æü‡Æ≤‡Øç",
                    seated: "‡Æâ‡Æü‡Øç‡Æï‡Ææ‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÅ",
                    posture: "‡Æâ‡Æü‡Æ≤‡Øç‡Æ®‡Æø‡Æ≤‡Øà",
                    chest: "‡ÆÆ‡Ææ‡Æ∞‡Øç‡Æ™‡ØÅ"
                },
                exercises: {
                    neckrolls: {
                        name: "‡Æï‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ ‡Æö‡ØÅ‡Æ¥‡Æ±‡Øç‡Æö‡Æø",
                        description: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ§‡Æ≤‡Øà‡ÆØ‡Øà ‡ÆÆ‡ØÜ‡Æ§‡ØÅ‡Æµ‡Ææ‡Æï ‡Æµ‡Æü‡Øç‡Æü‡ÆÆ‡Ææ‡Æï ‡Æö‡ØÅ‡Æ¥‡Æ±‡Øç‡Æ±‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç, ‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Æø‡Æ≤‡Øç ‡Æï‡Æü‡Æø‡Æï‡Ææ‡Æ∞ ‡Æ§‡Æø‡Æö‡Øà‡ÆØ‡Æø‡Æ≤‡Øç, ‡Æ™‡Æø‡Æ©‡Øç‡Æ©‡Æ∞‡Øç ‡Æé‡Æ§‡Æø‡Æ∞‡Øç ‡Æ§‡Æø‡Æö‡Øà‡ÆØ‡Æø‡Æ≤‡Øç. ‡Æá‡ÆØ‡Æï‡Øç‡Æï‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡ÆÆ‡ØÜ‡Æ©‡Øç‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æü‡Øç‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡Æü‡Øç‡Æü‡ØÅ‡Æü‡Æ©‡ØÅ‡ÆÆ‡Øç ‡Æµ‡Øà‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç."
                    },
                    shouldershrugs: {
                        name: "‡Æ§‡Øã‡Æ≥‡Øç ‡Æâ‡ÆØ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡ØÅ‡Æ§‡Æ≤‡Øç",
                        description: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ§‡Øã‡Æ≥‡Øç‡Æï‡Æ≥‡Øà ‡Æï‡Ææ‡Æ§‡ØÅ‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æ®‡Øã‡Æï‡Øç‡Æï‡Æø ‡Æâ‡ÆØ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç, 3 ‡Æµ‡Æø‡Æ©‡Ææ‡Æü‡Æø‡Æï‡Æ≥‡Øç ‡Æµ‡Øà‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç, ‡Æ™‡Æø‡Æ©‡Øç‡Æ©‡Æ∞‡Øç ‡Æ§‡Æ≥‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç. ‡ÆÆ‡ØÜ‡Æ§‡ØÅ‡Æµ‡Ææ‡Æï ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç."
                    },
                    sideneckstretch: {
                        name: "‡Æ™‡Æï‡Øç‡Æï ‡Æï‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ ‡Æ®‡ØÄ‡Æü‡Øç‡Æö‡Æø",
                        description: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ§‡Æ≤‡Øà‡ÆØ‡Øà ‡Æµ‡Æ≤‡Æ§‡ØÅ ‡Æ™‡Æï‡Øç‡Æï‡ÆÆ‡Ææ‡Æï ‡ÆÆ‡ØÜ‡Æ§‡ØÅ‡Æµ‡Ææ‡Æï ‡Æö‡Ææ‡ÆØ‡Øç‡Æ§‡Øç‡Æ§‡ØÅ, 15 ‡Æµ‡Æø‡Æ©‡Ææ‡Æü‡Æø‡Æï‡Æ≥‡Øç ‡Æµ‡Øà‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç, ‡Æ™‡Æø‡Æ©‡Øç‡Æ©‡Æ∞‡Øç ‡Æá‡Æü‡Æ§‡ØÅ ‡Æ™‡Æï‡Øç‡Æï‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç."
                    },
                    forwardneckstretch: {
                        name: "‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Øã‡Æï‡Øç‡Æï‡Æø ‡Æï‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ ‡Æ®‡ØÄ‡Æü‡Øç‡Æö‡Æø",
                        description: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ§‡Ææ‡Æü‡Æø‡ÆØ‡Øà ‡ÆÆ‡ØÜ‡Æ§‡ØÅ‡Æµ‡Ææ‡Æï ‡ÆÆ‡Ææ‡Æ∞‡Øç‡Æ™‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æ®‡Øã‡Æï‡Øç‡Æï‡Æø ‡Æï‡ØÄ‡Æ¥‡Øá ‡Æï‡Øä‡Æ£‡Øç‡Æü‡ØÅ ‡Æµ‡Ææ‡Æ∞‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç, ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡Æø‡Æ©‡Øç ‡Æ™‡Æø‡Æ©‡Øç‡Æ™‡ØÅ‡Æ±‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡ÆÆ‡ØÜ‡Æ©‡Øç‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æ© ‡Æ®‡ØÄ‡Æü‡Øç‡Æö‡Æø‡ÆØ‡Øà ‡Æâ‡Æ£‡Æ∞‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç."
                    },
                    armcircles: {
                        name: "‡Æï‡Øà ‡Æµ‡Æü‡Øç‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç",
                        description: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Øà‡Æï‡Æ≥‡Ææ‡Æ≤‡Øç ‡Æö‡Æø‡Æ±‡Æø‡ÆØ ‡Æµ‡Æü‡Øç‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç, ‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Æø‡Æ≤‡Øç ‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Øã‡Æï‡Øç‡Æï‡Æø, ‡Æ™‡Æø‡Æ©‡Øç‡Æ©‡Æ∞‡Øç ‡Æ™‡Æø‡Æ©‡Øç‡Æ©‡Øã‡Æï‡Øç‡Æï‡Æø. ‡Æá‡ÆØ‡Æï‡Øç‡Æï‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡ÆÆ‡ØÜ‡Æ§‡ØÅ‡Æµ‡Ææ‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æü‡Øç‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡Æü‡Øç‡Æü‡ØÅ‡Æü‡Æ©‡ØÅ‡ÆÆ‡Øç ‡Æµ‡Øà‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç."
                    },
                    gentleTwist: {
                        name: "‡ÆÆ‡ØÜ‡Æ©‡Øç‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æ© ‡Æ§‡Æø‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡ÆÆ‡Øç",
                        description: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Ææ‡Æ≤‡Øç‡Æï‡Æ≥‡Øà ‡Æá‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ ‡ÆÖ‡Æï‡Æ≤‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æµ‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æ®‡Æø‡Æ±‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç, ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Øà‡Æï‡Æ≥‡Øà ‡Æá‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Æø‡Æ≤‡Øç ‡Æµ‡Øà‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç, ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æï‡Øç‡Æï‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Æø‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡Æ™‡Æï‡Øç‡Æï‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡ÆÆ‡ØÜ‡Æ§‡ØÅ‡Æµ‡Ææ‡Æï ‡Æ§‡Æø‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç."
                    },
                    calfraises: {
                        name: "‡Æï‡Ææ‡Æ≤‡Øç ‡Æ§‡Æö‡Øà ‡Æâ‡ÆØ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡ØÅ‡Æ§‡Æ≤‡Øç",
                        description: "‡Æ®‡Øá‡Æ∞‡Ææ‡Æï ‡Æ®‡Æø‡Æ±‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÜ‡Æ§‡ØÅ‡Æµ‡Ææ‡Æï ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Ææ‡Æ≤‡Øç ‡Æµ‡Æø‡Æ∞‡Æ≤‡Øç‡Æï‡Æ≥‡Æø‡Æ≤‡Øç ‡Æâ‡ÆØ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç, ‡Æ™‡Æø‡Æ©‡Øç‡Æ©‡Æ∞‡Øç ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æï‡ØÄ‡Æ¥‡Øá ‡Æï‡Øä‡Æ£‡Øç‡Æü‡ØÅ ‡Æµ‡Ææ‡Æ∞‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç. ‡Æá‡ÆØ‡Æï‡Øç‡Æï‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æï‡Æü‡Øç‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡Æü‡Øç‡Æü‡ØÅ‡Æü‡Æ©‡Øç ‡Æµ‡Øà‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç."
                    },
                    deepbreathing: {
                        name: "‡ÆÜ‡Æ¥‡ÆÆ‡Ææ‡Æ© ‡Æö‡ØÅ‡Æµ‡Ææ‡Æö‡ÆÆ‡Øç",
                        description: "5 ‡ÆÜ‡Æ¥‡ÆÆ‡Ææ‡Æ© ‡Æö‡ØÅ‡Æµ‡Ææ‡Æö‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æé‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç, ‡ÆÆ‡ØÇ‡Æï‡Øç‡Æï‡ØÅ ‡Æµ‡Æ¥‡Æø‡ÆØ‡Ææ‡Æï ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æ¥‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æµ‡Ææ‡ÆØ‡Øç ‡Æµ‡Æ¥‡Æø‡ÆØ‡Ææ‡Æï ‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Øá‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç. ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æâ‡Æü‡Æ≤‡Øç ‡Æ§‡Æ≥‡Æ∞‡Øç‡Æµ‡Æü‡Øà‡Æï‡Æø‡Æ±‡Æ§‡ØÅ ‡Æé‡Æ©‡Øç‡Æ™‡Æ§‡Øà ‡Æâ‡Æ£‡Æ∞‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç."
                    }
                },
                accessibility: {
                    toggleDarkMode: "‡Æá‡Æ∞‡ØÅ‡Æ£‡Øç‡Æü ‡Æ™‡ÆØ‡Æ©‡Øç‡ÆÆ‡ØÅ‡Æ±‡Øà‡ÆØ‡Øà ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç",
                    languageSelector: "‡ÆÆ‡Øä‡Æ¥‡Æø‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
                    startPauseTimer: "‡Æ™‡ÆØ‡Æø‡Æ±‡Øç‡Æö‡Æø ‡Æü‡Øà‡ÆÆ‡Æ∞‡Øà‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æá‡Æü‡Øà‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç",
                    nextExercise: "‡ÆÖ‡Æü‡ØÅ‡Æ§‡Øç‡Æ§ ‡Æ™‡ÆØ‡Æø‡Æ±‡Øç‡Æö‡Æø",
                    previousExercise: "‡ÆÆ‡ØÅ‡Æ®‡Øç‡Æ§‡Øà‡ÆØ ‡Æ™‡ÆØ‡Æø‡Æ±‡Øç‡Æö‡Æø",
                    backToRoutines: "‡Æµ‡Æ¥‡Æï‡Øç‡Æï‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æ§‡Øç ‡Æ§‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡Æµ‡ØÅ‡ÆÆ‡Øç"
                }
            }
        };
    }
}

// Language Selector Functionality
function setupLanguageSelector() {
    const languageButton = document.getElementById('language-button');
    const languageDropdown = document.getElementById('language-dropdown');
    const languageFlag = document.getElementById('language-flag');
    const currentLanguage = document.getElementById('current-language');
    
    if (!languageButton || !languageDropdown) {
        console.warn('Language selector elements not found');
        return;
    }
    
    // Populate dropdown with available languages
    function populateLanguageDropdown() {
        const languages = window.i18n.getAvailableLanguages();
        languageDropdown.innerHTML = '';
        
        languages.forEach(lang => {
            const option = document.createElement('div');
            option.className = 'language-option';
            option.dataset.lang = lang.code;
            
            if (lang.code === window.i18n.currentLang) {
                option.classList.add('selected');
            }
            
            option.innerHTML = `
                <span class="language-option-flag">${lang.flag}</span>
                <span class="language-option-name">${lang.name}</span>
            `;
            
            option.addEventListener('click', () => {
                window.i18n.changeLanguage(lang.code);
                updateLanguageDisplay(lang);
                closeDropdown();
            });
            
            languageDropdown.appendChild(option);
        });
    }
    
    // Update language display
    function updateLanguageDisplay(lang) {
        if (languageFlag) languageFlag.textContent = lang.flag;
        if (currentLanguage) currentLanguage.textContent = lang.code.toUpperCase();
    }
    
    // Toggle dropdown
    function toggleDropdown() {
        const isOpen = languageDropdown.classList.contains('open');
        if (isOpen) {
            closeDropdown();
        } else {
            openDropdown();
        }
    }
    
    // Open dropdown
    function openDropdown() {
        languageDropdown.classList.add('open');
        languageButton.setAttribute('aria-expanded', 'true');
    }
    
    // Close dropdown
    function closeDropdown() {
        languageDropdown.classList.remove('open');
        languageButton.setAttribute('aria-expanded', 'false');
    }
    
    // Event listeners
    languageButton.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleDropdown();
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
        if (!languageButton.contains(e.target) && !languageDropdown.contains(e.target)) {
            closeDropdown();
        }
    });
    
    // Close dropdown on escape key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            closeDropdown();
        }
    });
    
    // Initialize dropdown
    populateLanguageDropdown();
    
    // Set initial language display
    const currentLang = window.i18n.getAvailableLanguages().find(lang => lang.code === window.i18n.currentLang);
    if (currentLang) {
        updateLanguageDisplay(currentLang);
    }
}

// Initialize global i18n instance
window.i18n = new BendI18n();

// Setup language selector and apply translations when DOM is ready
function initializeApp() {
    setupLanguageSelector();
    // Apply translations after DOM is ready with a small delay to ensure all elements are loaded
    setTimeout(() => {
        window.i18n.applyTranslations();
    }, 100);
}

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeApp);
} else {
    initializeApp();
}

// Export for module systems
if (typeof module !== 'undefined' && module.exports) {
    module.exports = BendI18n;
}
